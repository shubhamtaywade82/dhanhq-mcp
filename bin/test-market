#!/usr/bin/env ruby
# frozen_string_literal: true

# Manual test script for PHASE 3 market data tools
# Usage: DHAN_TOKEN=your_token bin/test-market

$LOAD_PATH.unshift(File.expand_path("../lib", __dir__))

require "dhanhq-mcp"

# Configuration
DhanHQ.configure do |config|
  config.client_id = ENV.fetch("CLIENT_ID", "test")
  config.access_token = ENV.fetch("DHAN_TOKEN") do
    abort "ERROR: DHAN_TOKEN environment variable required"
  end
end

# Create context
client = DhanHQ::Client.new(access_token: ENV["DHAN_TOKEN"])
context = Dhanhq::Mcp::Context.new(client: client)

puts "=== Testing instrument.ltp ==="
result = Dhanhq::Mcp::Tools::Instrument.new(context).ltp(
  "exchange_segment" => "IDX_I",
  "symbol" => "NIFTY",
)
puts JSON.pretty_generate(result)

puts "\n=== Testing instrument.quote ==="
result = Dhanhq::Mcp::Tools::Instrument.new(context).quote(
  "exchange_segment" => "IDX_I",
  "symbol" => "NIFTY",
)
puts "Quote keys: #{result.keys.join(", ")}"

puts "\n=== Testing instrument.ohlc ==="
result = Dhanhq::Mcp::Tools::Instrument.new(context).ohlc(
  "exchange_segment" => "IDX_I",
  "symbol" => "NIFTY",
)
puts JSON.pretty_generate(result)

puts "\nâœ… CHECKPOINT PASSED - Market data tools working"
puts "\nNOTE: instrument.daily and instrument.intraday require date parameters"
puts "Test those manually with specific date ranges"
