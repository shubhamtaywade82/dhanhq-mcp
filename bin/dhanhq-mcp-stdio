#!/usr/bin/env ruby
# frozen_string_literal: true

$LOAD_PATH.unshift(File.expand_path("../lib", __dir__))

require "dotenv/load"
require "dhan_hq"
require "dhanhq-mcp"

# Configure DhanHQ from environment
DhanHQ.configure_with_env
DhanHQ.logger.level = (ENV["DHAN_LOG_LEVEL"] || "INFO").upcase.then { |level| Logger.const_get(level) }

# Create context (tools use DhanHQ global config, not context.client)
client = Object.new
context = Dhanhq::Mcp::Context.new(client: client)

# Start MCP STDIO server - blocks forever
server = Dhanhq::Mcp::StdioServer.new(context: context)
server.run
